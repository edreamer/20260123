<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>å¹³ç”©åŠŸä¿®ç…‰åŠ©æ‰‹ - è²éŸ³å¼·åŒ–ç©©å®šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #f8fafc;
        }
        .progress-wave { transition: height 1.2s linear; }
        .active-glow { filter: drop-shadow(0 0 12px rgba(79, 70, 229, 0.5)); }
        /* å„ªåŒ–æ²å‹•é«”é©— */
        .scroll-container {
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icons = {
            Timer: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            ),
            RotateCcw: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            ),
            Play: () => (
                <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            ),
            Pause: () => (
                <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
            ),
            Volume2: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
            ),
            VolumeX: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>
            ),
            Check: () => (
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3.5"><polyline points="20 6 9 17 4 12"/></svg>
            )
        };

        const workerCode = `
            let timer = null;
            self.onmessage = function(e) {
                if (e.data.action === 'start') {
                    if (timer) clearInterval(timer);
                    timer = setInterval(() => { self.postMessage('tick'); }, e.data.interval);
                } else if (e.data.action === 'stop') {
                    clearInterval(timer);
                    timer = null;
                }
            };
        `;

        const App = () => {
            const [timeLeft, setTimeLeft] = useState(0);
            const [isActive, setIsActive] = useState(false);
            const [totalSeconds, setTotalSeconds] = useState(0);
            const [swingCount, setSwingCount] = useState(0);
            const [customMinutes, setCustomMinutes] = useState(10);
            const [showSettings, setShowSettings] = useState(false);
            const [isFinished, setIsFinished] = useState(false);
            const [volume, setVolume] = useState(0.9);
            const [isMuted, setIsMuted] = useState(false);
            const [audioStarted, setAudioStarted] = useState(false);
            
            const workerRef = useRef(null);
            const audioCtx = useRef(null);
            const masterGain = useRef(null);

            useEffect(() => {
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                workerRef.current = new Worker(URL.createObjectURL(blob));
                workerRef.current.onmessage = () => {
                    setTimeLeft(prev => {
                        if (prev <= 1) { handleStop(true); return 0; }
                        return prev - 1;
                    });
                    setSwingCount(prev => {
                        const next = prev + 1;
                        if (next % 5 === 0) playTone(220, 0.45, 'square', 0.8);
                        else playTone(880, 0.1, 'triangle', 0.5);
                        return next;
                    });
                };
                return () => workerRef.current?.terminate();
            }, []);

            useEffect(() => {
                if (masterGain.current && audioCtx.current) {
                    masterGain.current.gain.setTargetAtTime(isMuted ? 0 : volume, audioCtx.current.currentTime, 0.1);
                }
            }, [volume, isMuted]);

            const initAudio = () => {
                if (!audioCtx.current) {
                    audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                    masterGain.current = audioCtx.current.createGain();
                    masterGain.current.gain.value = volume;
                    masterGain.current.connect(audioCtx.current.destination);
                }
                if (audioCtx.current.state === 'suspended') {
                    audioCtx.current.resume();
                }
                setAudioStarted(true);
                // æ¸¬è©¦éŸ³
                playTone(440, 0.1, 'sine', 0.2);
            };

            const playTone = (freq, dur, type, baseVol) => {
                if (!audioCtx.current || !isActive || isMuted) return;
                try {
                    const now = audioCtx.current.currentTime;
                    const osc = audioCtx.current.createOscillator();
                    const gain = audioCtx.current.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, now);
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(baseVol, now + 0.01);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + dur);
                    osc.connect(gain);
                    gain.connect(masterGain.current);
                    osc.start(now);
                    osc.stop(now + dur);
                } catch(e) {}
            };

            const handleStart = () => {
                if (!audioStarted) initAudio();
                if (timeLeft <= 0) {
                    const s = customMinutes * 60;
                    setTimeLeft(s);
                    setTotalSeconds(s);
                }
                setIsActive(true);
                setIsFinished(false);
                workerRef.current.postMessage({ action: 'start', interval: 1200 });
                
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = 'playing';
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: 'å¹³ç”©åŠŸä¿®ç…‰ä¸­',
                        artist: 'æé³³å±±å¸«çˆ¶ å°å¼•'
                    });
                }
            };

            const handleStop = (autoFinished = false) => {
                workerRef.current?.postMessage({ action: 'stop' });
                setIsActive(false);
                if (autoFinished) {
                    setIsFinished(true);
                    playTone(523, 0.5, 'sine', 0.5);
                    setTimeout(() => playTone(659, 0.5, 'sine', 0.5), 200);
                    setTimeout(() => playTone(783, 0.8, 'sine', 0.5), 400);
                }
            };

            const formatTime = (s) => {
                const m = Math.floor(s / 60);
                const sec = s % 60;
                return `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            };

            return (
                <div className="scroll-container w-full min-h-screen flex flex-col items-center p-4 pb-20 bg-slate-50 overflow-y-auto">
                    <header className="w-full max-w-md flex justify-between items-center my-6">
                        <div className="flex items-center gap-3">
                            <div className="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black shadow-lg text-xl">å¹³</div>
                            <div>
                                <h1 className="text-xl font-black text-slate-900 leading-tight">å¹³ç”©åŠ©æ‰‹</h1>
                                <p className="text-[10px] font-bold text-indigo-500 tracking-widest uppercase">Volume Boosted</p>
                            </div>
                        </div>
                        <button onClick={() => setShowSettings(true)} className="p-3 bg-white rounded-2xl shadow-sm border border-slate-100">
                            <Icons.Timer />
                        </button>
                    </header>

                    {!audioStarted && (
                        <div className="w-full max-w-md mb-6 animate-bounce">
                            <button onClick={initAudio} className="w-full bg-orange-500 text-white py-4 rounded-2xl font-black shadow-lg text-center">
                                ğŸ”Š é»æ­¤é–‹å•Ÿè²éŸ³ (iPhone å¿…é»)
                            </button>
                        </div>
                    )}

                    <main className="w-full max-w-md bg-white rounded-[3rem] shadow-xl p-8 sm:p-10 flex flex-col items-center relative overflow-hidden border border-white">
                        <div className="absolute inset-x-0 bottom-0 bg-indigo-50/60 progress-wave" style={{ height: `${(totalSeconds > 0 ? ((totalSeconds - timeLeft) / totalSeconds) * 100 : 0)}%` }} />
                        
                        <div className="relative z-10 w-full flex flex-col items-center">
                            <div className={`px-5 py-1.5 rounded-full text-[11px] font-black mb-6 tracking-widest uppercase ${isActive ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-400'}`}>
                                {isActive ? "ä¿®ç…‰ä¸­..." : "æº–å‚™é–‹å§‹"}
                            </div>
                            
                            <div className="text-[5.5rem] font-black text-slate-800 mb-6 tracking-tighter tabular-nums leading-none">
                                {formatTime(timeLeft)}
                            </div>

                            <div className="flex gap-4 mb-10">
                                {[1, 2, 3, 4, 5].map(i => {
                                    const step = (swingCount % 5 === 0 && swingCount > 0) ? 5 : (swingCount % 5);
                                    const active = step === i && isActive;
                                    return (
                                        <div key={i} className={`w-5 h-5 rounded-full transition-all duration-300 ${active ? (i === 5 ? 'bg-rose-500 scale-150 shadow-lg' : 'bg-indigo-500 scale-125') : 'bg-slate-100'}`} />
                                    );
                                })}
                            </div>

                            <div className="h-10 mb-8 flex items-center">
                                {isActive && swingCount % 5 === 0 && (
                                    <span className="text-rose-600 font-black text-2xl animate-bounce">â†“ ä¸‹è¹²å½ˆå…©ä¸‹ â†“</span>
                                )}
                            </div>

                            <div className="w-full mb-10 bg-slate-50 p-4 rounded-3xl flex items-center gap-4">
                                <button onClick={() => setIsMuted(!isMuted)} className="text-indigo-600">
                                    {isMuted ? <Icons.VolumeX /> : <Icons.Volume2 />}
                                </button>
                                <input type="range" min="0" max="1.5" step="0.1" value={volume} onChange={(e) => setVolume(parseFloat(e.target.value))} className="flex-1 accent-indigo-600 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" />
                                <span className="text-xs font-bold text-slate-400 w-10 text-right">{Math.round(volume * 100)}%</span>
                            </div>

                            <div className="flex items-center gap-10">
                                <button onClick={() => { handleStop(false); setTimeLeft(0); setSwingCount(0); }} className="p-6 bg-slate-50 text-slate-400 rounded-3xl hover:bg-slate-100">
                                    <Icons.RotateCcw />
                                </button>
                                <button onClick={isActive ? () => handleStop(false) : handleStart} className={`p-10 rounded-[2.5rem] shadow-2xl transition-all ${isActive ? 'bg-rose-500 text-white' : 'bg-indigo-600 text-white'}`}>
                                    {isActive ? <Icons.Pause /> : <Icons.Play />}
                                </button>
                            </div>
                        </div>
                    </main>

                    <div className="w-full max-w-md grid grid-cols-3 gap-4 mt-8">
                        {[10, 20, 30].map(m => (
                            <button key={m} onClick={() => { setTimeLeft(m*60); setTotalSeconds(m*60); setCustomMinutes(m); setIsFinished(false); }} className={`py-4 rounded-2xl font-black text-lg border-2 ${customMinutes === m && !isActive ? 'bg-indigo-600 text-white border-indigo-600 shadow-lg' : 'bg-white text-slate-400 border-slate-100'}`}>
                                {m} åˆ†
                            </button>
                        ))}
                    </div>

                    <footer className="mt-10 mb-10 text-center">
                        <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">æé³³å±±å¸«çˆ¶ å‚³æ‰¿ Â· å¹³ç”©é¤Šç”Ÿ</p>
                    </footer>

                    {showSettings && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-lg z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-[3rem] p-10 w-full max-w-md shadow-2xl">
                                <h3 className="text-2xl font-black mb-8 text-slate-900">è‡ªè¨‚åˆ†é˜</h3>
                                <div className="flex items-center justify-center gap-4 mb-10">
                                    <input type="number" value={customMinutes} onChange={e => setCustomMinutes(Math.max(1, parseInt(e.target.value)||1))} className="w-32 text-6xl font-black text-center text-indigo-600 border-b-4 border-indigo-500 focus:outline-none" />
                                    <span className="text-2xl font-black text-slate-300">MIN</span>
                                </div>
                                <button onClick={() => { setTimeLeft(customMinutes*60); setTotalSeconds(customMinutes*60); setShowSettings(false); }} className="w-full bg-indigo-600 text-white py-6 rounded-3xl font-black text-xl">ç¢ºèªè¨­å®š</button>
                                <button onClick={() => setShowSettings(false)} className="w-full mt-4 text-slate-400 font-bold py-2">å–æ¶ˆ</button>
                            </div>
                        </div>
                    )}

                    {isFinished && (
                        <div className="fixed inset-0 bg-indigo-950/95 z-[60] flex items-center justify-center p-8 text-center text-white backdrop-blur-2xl">
                            <div className="max-w-xs">
                                <div className="w-24 h-24 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-8 border border-white/20">
                                    <Icons.Check />
                                </div>
                                <h2 className="text-5xl font-black mb-6">åŠŸå¾·åœ“æ»¿</h2>
                                <p className="text-lg text-indigo-100/80 mb-10">é›™æ‰‹ç·©ç·©åœä¸‹ï¼Œé–‰ç›®éœç«™ä¸‰åˆ†é˜ã€‚æ„Ÿå—æ°£è¡€æµéå…¨èº«ã€‚</p>
                                <button onClick={() => setIsFinished(false)} className="w-full bg-white text-indigo-900 py-6 rounded-3xl font-black text-2xl">æ”¶åŠŸ</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>